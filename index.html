<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Gorilla Tag WebXR Demo</title>
    <meta name="description" content="Gorilla Tag-style VR movement">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene xrweb no-permission>
      <!-- Ground -->
      <a-plane position="0 0 -4" rotation="-90 0 0" width="20" height="20" color="#7BC8A4"></a-plane>

      <!-- Wall -->
      <a-box position="0 1 -10" depth="0.5" height="4" width="8" color="#8AC"></a-box>

      <!-- Lighting -->
      <a-entity light="type: ambient; color: #BBB"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.5" position="1 3 1"></a-entity>

      <!-- Camera rig with hands -->
      <a-entity id="rig" position="0 1.6 0">
        <a-entity camera look-controls wasd-controls></a-entity>

        <!-- Left Hand -->
        <a-entity id="leftHand" hand-controls="hand: left" physics-hand></a-entity>

        <!-- Right Hand -->
        <a-entity id="rightHand" hand-controls="hand: right" physics-hand></a-entity>
      </a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent("physics-hand", {
        tick: function () {
          const rig = document.querySelector("#rig");
          const hand = this.el;

          // Track controller position and velocity
          const prevPos = hand.getAttribute("prevPos") || hand.object3D.position.clone();
          const currPos = hand.object3D.position;
          const velocity = new THREE.Vector3().subVectors(prevPos, currPos);

          // If colliding with the ground or wall, apply opposite movement to rig
          const intersections = hand.components["hand-controls"].intersectedEls || [];
          if (intersections.length > 0) {
            rig.object3D.position.add(velocity.multiplyScalar(2)); // Move rig opposite to hand
          }

          hand.setAttribute("prevPos", currPos.clone());
        }
      });
    </script>
  </body>
</html>
